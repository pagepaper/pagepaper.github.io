---
title: extern的用法小结
date: 2007-03-09 13:07:58
updated: 2007-03-09 13:07:58
categories : 
  - [编程开发]
tags:
urlname: c5cf5d161abda59366aa61be95bc6bda
---
<strong>(extern 变量) (extern 函数) 解析</strong>

这种情况下的extern说明变量或者函数声明在其他的源文件里，而不用include头文件的方式来引用该函数，在链接时，链接器在各个模块中搜索这个变量或者函数来进行最终链接。

<strong>(extern “C”) 解析</strong>

使用这种extern的情况多发生在使用C++调用由C写成的函数库时，此时编译过程中常发生编译器找不到C函数的问题，从而导致链接失败。为了解决这种情况，才引用了extern “C”这种用法。

那为什么又会出现这种链接失败的情况呢？简单来是由于g++和gcc生成函数名称方式的不同造成的。C++语言在编译的时候为了解决函数的多态问题，不会直接使用程序中书写的函数名称，而会使用一种特别的方法经过中间变换过程生成一个全局唯一函数名。C库函数是没有经过函数名称变换得来的，当C++使用经过变换的函数名称去调没有变换过的函数时，肯定会出现链接失败的情况。

这种特殊的转换方法叫做“名称的特殊处理（Name Mangling）”，比如C++将函数名和参数联合起来生成一个中间的函数名称，而C语言则不会，因此会造成链接时找不到对应函数的情况，此时C函数就需要用extern “C”进行链接指定，这告诉编译器，这是一个用C写成的库文件，请用C的方式来链接它们。

下面我们使用一个简单的例子来说明这个问题。我们分别编译如下两段基本相同的程序，重点留意下函数”int f(void)”，在两种书写方式下的汇编语言表示方法。将源代码分别保存后，使用g++ -S test1.cpp和g++ -S test2.cpp编译生成汇编代码，对比如下，红色部分标出左右两部分不同的部分。

![](/images/c5cf5d161abda59366aa61be95bc6bda/1.png)

<p>

![](/images/c5cf5d161abda59366aa61be95bc6bda/2.png)
